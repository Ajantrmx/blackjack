<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karar Çarkı - Fizik Tabanlı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow-x: hidden;
        }

        #wheel-container {
            position: relative;
            width: 350px;
            height: 350px;
            margin: 0 auto;
        }

        #wheel-wrapper {
            width: 100%;
            height: 100%;
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
            will-change: transform;
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 6px solid #1e293b;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        /* Fiziksel Ok (Pointer) */
        #pointer-wrapper {
            position: absolute;
            top: -15px;
            left: 50%;
            transform-origin: 50% 0%;
            transform: translateX(-50%) rotate(0deg);
            z-index: 20;
            transition: transform 0.1s ease-out; /* Yayın geri dönüş hızı */
        }

        #pointer {
            width: 40px;
            height: 45px;
            background: #ef4444;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        .input-area {
            max-height: 250px;
            overflow-y: auto;
        }

        #modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(6px);
            z-index: 50;
            align-items: center;
            justify-content: center;
        }

        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            z-index: 100;
            pointer-events: none;
        }

        @media (max-width: 400px) {
            #wheel-container {
                width: 280px;
                height: 280px;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="modal-overlay">
        <div class="bg-slate-800 border border-slate-700 p-8 rounded-3xl shadow-2xl text-center max-w-sm w-full mx-4 transform scale-110">
            <h3 class="text-indigo-400 text-lg font-semibold mb-2">Kazanan!</h3>
            <div id="modal-result-text" class="text-4xl font-bold text-white mb-6"></div>
            <button onclick="closeModal()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition-colors">
                Tamam
            </button>
        </div>
    </div>

    <div class="max-w-4xl mx-auto bg-slate-900 rounded-3xl shadow-2xl border border-slate-800 overflow-hidden flex flex-col md:flex-row">
        
        <div class="w-full md:w-1/2 p-8 flex flex-col items-center justify-center bg-slate-900 border-b md:border-b-0 md:border-r border-slate-800">
            <h1 class="text-2xl font-bold mb-8 text-indigo-400">KARAR ÇARKI</h1>
            
            <div id="wheel-container">
                <div id="pointer-wrapper">
                    <div id="pointer"></div>
                </div>
                <div id="wheel-wrapper">
                    <canvas id="wheel"></canvas>
                </div>
            </div>

            <button id="spin-btn" class="mt-10 px-12 py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-full transition-all shadow-lg shadow-indigo-500/20 active:scale-95 uppercase tracking-widest">
                ÇEVİR!
            </button>
        </div>

        <div class="w-full md:w-1/2 p-8 bg-slate-900/50">
            <h2 class="text-xl font-semibold mb-6 text-slate-300">Seçenekleri Yönet</h2>
            
            <div class="flex gap-2 mb-6">
                <input type="text" id="option-input" placeholder="Seçenek ekle..." class="flex-1 px-4 py-3 bg-slate-800 border border-slate-700 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <button id="add-btn" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition-all">Ekle</button>
            </div>

            <div id="options-list" class="input-area space-y-2 pr-2"></div>

            <div class="mt-8 p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50">
                <p class="text-xs text-slate-500">
                    Kırmızı ok artık çarkın dönüş hızına ve dilim geçişlerine fiziksel tepki verir.
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheel');
        const wheelWrapper = document.getElementById('wheel-wrapper');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spin-btn');
        const pointerWrapper = document.getElementById('pointer-wrapper');
        const optionInput = document.getElementById('option-input');
        const addBtn = document.getElementById('add-btn');
        const optionsList = document.getElementById('options-list');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalText = document.getElementById('modal-result-text');

        let options = ["Lahmacun", "Pizza", "Hamburger", "Salata", "Sushi", "Ev Yemeği"];
        let colors = ["#6366f1", "#ec4899", "#f59e0b", "#10b981", "#8b5cf6", "#f43f5e", "#06b6d4", "#eab308"];
        
        let currentRotation = 0;
        let isSpinning = false;
        let lastTargetSlice = -1;

        function init() {
            renderOptions();
            drawWheel();
        }

        function drawWheel() {
            const size = 600; 
            canvas.width = size;
            canvas.height = size;
            const centerX = size / 2;
            const centerY = size / 2;
            const radius = size / 2 - 10;
            
            const sliceAngle = (2 * Math.PI) / options.length;

            ctx.clearRect(0, 0, size, size);

            options.forEach((option, i) => {
                const startAngle = i * sliceAngle;
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
                ctx.strokeStyle = '#0f172a';
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#ffffff";
                ctx.font = "bold 24px Poppins";
                ctx.fillText(option, radius - 40, 10);
                ctx.restore();
            });

            // Orta pim
            ctx.beginPath();
            ctx.arc(centerX, centerY, 15, 0, 2 * Math.PI);
            ctx.fillStyle = "#ffffff";
            ctx.fill();
        }

        function renderOptions() {
            optionsList.innerHTML = '';
            options.forEach((opt, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-slate-800 p-3 rounded-xl border border-slate-700/50';
                div.innerHTML = `
                    <span class="truncate text-slate-200">${opt}</span>
                    <button onclick="removeOption(${index})" class="text-slate-500 hover:text-red-400 transition-colors px-2">Sil</button>
                `;
                optionsList.appendChild(div);
            });
            drawWheel();
        }

        function addOption() {
            const val = optionInput.value.trim();
            if (val && options.length < 24) {
                options.push(val);
                optionInput.value = '';
                renderOptions();
            }
        }

        window.removeOption = function(index) {
            if (options.length > 2) {
                options.splice(index, 1);
                renderOptions();
            }
        };

        // Fiziksel Ok Animasyon Döngüsü
        let animationFrameId;
        function updatePointerPhysics() {
            if (!isSpinning) return;

            // Çarkın o anki rotasyonunu matris üzerinden al
            const style = window.getComputedStyle(wheelWrapper);
            const matrix = new WebKitCSSMatrix(style.transform);
            const angle = Math.atan2(matrix.b, matrix.a) * (180 / Math.PI);
            const normalizedAngle = (angle < 0 ? angle + 360 : angle);

            const sliceSizeDeg = 360 / options.length;
            // Pointer yukarıda (270 derecede) duruyor. 
            // Çarkın dilim geçişlerini takip etmek için ofset kullanıyoruz.
            const currentSlice = Math.floor(((360 - normalizedAngle + 270) % 360) / sliceSizeDeg);

            if (currentSlice !== lastTargetSlice) {
                // Dilim değişti! Oku "tık" diye salla.
                // Sallantı miktarı zamanla azalmalı (hız azaldığı için)
                // Hızı basitçe CSS transition süresinden kestirebiliriz ama burada görsel etki yeterli.
                const intensity = 15; // Maksimum sallanma açısı
                pointerWrapper.style.transform = `translateX(-50%) rotate(-${intensity}deg)`;
                
                // Geri yaylanma
                setTimeout(() => {
                    pointerWrapper.style.transform = `translateX(-50%) rotate(0deg)`;
                }, 50);
                
                lastTargetSlice = currentSlice;
            }

            animationFrameId = requestAnimationFrame(updatePointerPhysics);
        }

        function spin() {
            if (isSpinning) return;
            
            isSpinning = true;
            const extraRounds = Math.floor(Math.random() * 5) + 7; 
            const randomDegree = Math.floor(Math.random() * 360);
            const totalRotation = extraRounds * 360 + randomDegree;
            
            currentRotation += totalRotation;
            wheelWrapper.style.transform = `rotate(${currentRotation}deg)`;

            lastTargetSlice = -1;
            updatePointerPhysics();

            setTimeout(() => {
                isSpinning = false;
                cancelAnimationFrame(animationFrameId);
                
                const actualDegree = currentRotation % 360;
                const sliceDegree = 360 / options.length;
                const winningIndex = Math.floor(((360 - (actualDegree % 360) + 270) % 360) / sliceDegree);
                
                showWinner(options[winningIndex]);
            }, 4000);
        }

        function showWinner(winner) {
            modalText.innerText = winner;
            modalOverlay.style.display = 'flex';
            createConfetti();
        }

        window.closeModal = function() {
            modalOverlay.style.display = 'none';
        };

        function createConfetti() {
            const colors = ['#f43f5e', '#3b82f6', '#10b981', '#fbbf24', '#8b5cf6'];
            for (let i = 0; i < 60; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-10px';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.borderRadius = Math.random() > 0.5 ? '50%' : '0%';
                document.body.appendChild(conf);

                conf.animate([
                    { transform: `translate3d(0,0,0) rotate(0deg)`, opacity: 1 },
                    { transform: `translate3d(${Math.random() * 200 - 100}px, 100vh, 0) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 2000 + 1500,
                    easing: 'cubic-bezier(0, .9, .57, 1)'
                }).onfinish = () => conf.remove();
            }
        }

        addBtn.addEventListener('click', addOption);
        optionInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addOption(); });
        spinBtn.addEventListener('click', spin);

        window.onload = init;
    </script>
</body>
</html>


